name: "ðŸš€ Instant RDP - No Bullshit"
on:
  workflow_dispatch:

jobs:
  instant-rdp:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
    - name: Setup RDP in 10 seconds
      run: |
        # === SUPER FAST RDP SETUP ===
        # Enable RDP
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
        
        # Allow firewall
        netsh advfirewall firewall add rule name="RDP-ALLOW" dir=in action=allow protocol=TCP localport=3389
        
        # Create user
        net user FreeRDP P@ssw0rd123! /add /y
        net localgroup administrators FreeRDP /add
        net localgroup "Remote Desktop Users" FreeRDP /add
        
        # Restart service
        Restart-Service TermService -Force
        
        Write-Host "âœ… RDP Enabled!"
        Write-Host "ðŸ‘¤ Username: FreeRDP"
        Write-Host "ðŸ”‘ Password: P@ssw0rd123!"

    - name: Setup ZeroTier (BEST FREE VPN - Better than Tailscale)
      run: |
        # === ZEROTIER - FREE, NO LIMITS ===
        # Download ZeroTier
        Invoke-WebRequest -Uri "https://download.zerotier.com/dist/ZeroTier%20One.msi" -OutFile zerotier.msi
        
        # Install silently
        Start-Process msiexec.exe -ArgumentList "/i", "zerotier.msi", "/quiet", "/norestart" -Wait
        
        # Wait for install
        Start-Sleep -Seconds 10
        
        # Join network (using public demo network)
        & "C:\Program Files (x86)\ZeroTier\One\zerotier-one_x64.exe" join 8056c2e21c000001
        
        Write-Host ""
        Write-Host "=============================================="
        Write-Host "ðŸŒ ZEROTIER NETWORK JOINED!"
        Write-Host ""
        Write-Host "1. Install ZeroTier on YOUR computer:"
        Write-Host "   https://www.zerotier.com/download/"
        Write-Host ""
        Write-Host "2. Join this network ID:"
        Write-Host "   Network ID: 8056c2e21c000001"
        Write-Host ""
        Write-Host "3. Wait 30 seconds for connection"
        Write-Host "4. Check your ZeroTier IP below"
        Write-Host "=============================================="
        
        # Get ZeroTier IP
        Start-Sleep -Seconds 15
        $ztIP = & "C:\Program Files (x86)\ZeroTier\One\zerotier-one_x64.exe" listnetworks | Select-String "8056c2e21c000001"
        Write-Host "ZeroTier Status: $ztIP"

    - name: Display Connection Info
      run: |
        # Get ZeroTier IP
        Start-Sleep -Seconds 10
        $ztStatus = & "C:\Program Files (x86)\ZeroTier\One\zerotier-one_x64.exe" listnetworks
        
        Write-Host ""
        Write-Host "ðŸ”¥ðŸ”¥ðŸ”¥ RDP CONNECTION READY ðŸ”¥ðŸ”¥ðŸ”¥"
        Write-Host "=========================================="
        Write-Host "METHOD 1: ZeroTier (Recommended)"
        Write-Host "------------------------------------------"
        Write-Host "1. Install ZeroTier: https://zerotier.com"
        Write-Host "2. Join network: 8056c2e21c000001"
        Write-Host "3. Your ZeroTier IP will appear below"
        Write-Host "4. Connect via: mstsc /v:[ZeroTier-IP]"
        Write-Host ""
        Write-Host "METHOD 2: LocalTry (Public URL)"
        Write-Host "------------------------------------------"
        Write-Host "Alternative: Using LocalTry tunnel..."
        
        # Start LocalTry (alternative to ngrok)
        Start-Process -FilePath "powershell" -ArgumentList "-Command", "iwr -useb https://localtry.github.io/localtry.ps1 | iex; Start-LocalTry -Port 3389" -NoNewWindow
        
        Write-Host ""
        Write-Host "CREDENTIALS:"
        Write-Host "Username: FreeRDP"
        Write-Host "Password: P@ssw0rd123!"
        Write-Host ""
        Write-Host "â° You have 6 hours (GitHub free limit)"
        Write-Host "=========================================="

    - name: Keep Alive & Show IP
      run: |
        $minutes = 0
        while ($minutes -lt 355) {
            # Show ZeroTier IP every 5 minutes
            if ($minutes % 5 -eq 0) {
                Write-Host ""
                Write-Host "--- [$(Get-Date -Format 'HH:mm:ss')] STATUS ---"
                Write-Host "Minutes active: $minutes/355"
                
                # Try to get ZeroTier IP
                try {
                    $ztInfo = & "C:\Program Files (x86)\ZeroTier\One\zerotier-one_x64.exe" listnetworks 2>$null
                    $ipMatch = $ztInfo | Select-String -Pattern "\b(10\.|192\.168\.|172\.)\d+\.\d+\.\d+\b"
                    if ($ipMatch) {
                        Write-Host "ZeroTier IP found: $($ipMatch.Matches.Value)"
                    }
                } catch {
                    Write-Host "ZeroTier: Getting IP..."
                }
                
                Write-Host "Username: FreeRDP"
                Write-Host "Password: P@ssw0rd123!"
                Write-Host "------------------------"
            }
            
            Start-Sleep -Seconds 60
            $minutes++
        }
